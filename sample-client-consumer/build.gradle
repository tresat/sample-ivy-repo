/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.10.2/userguide/java_library_plugin.html
 */

plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'java-library'
}

apply plugin: 'idea'

defaultTasks 'build'

configurations {
    sources
}

dependencies {
    def sampleClientBin = [group: 'com.test', name:'sample', version: '1.0', configuration: 'client']
    def sampleClientSources = [group: 'com.test', name:'sample', version: '1.0', configuration: 'client-source']
    
    implementation sampleClientBin
    sources sampleClientSources
}

repositories {
    ivy {
        name 'localserver'

        url 'http://localhost:8080/'
        layout 'pattern', {
            artifact '[organisation]/[module]/[artifact]-[type]-[revision].[ext]'
            ivy '[organisation]/[module]/ivy-[revision].xml'
        }
        metadataSources {
            ivyDescriptor()
        }
    }

    /*ivy {
        name 'subdirectory'

        def subdirectoryRepo = file("file://${projectDir}/../repo").toURI().toURL().toString()
        url subdirectoryRepo
        layout 'pattern', {
            artifact '[organisation]/[module]/[artifact]-[type]-[revision].[ext]'
            ivy '[organisation]/[module]/ivy-[revision].xml'
        }
        metadataSources {
            ivyDescriptor()
        }
    }*/
}

// Force resolve sources config and download those deps
configurations.sources.findAll { x -> true }

idea {
    module {
        downloadSources = true
        // throw new RuntimeException("fail")
    }
}
